#! /bin/bash -vex

# $1 == repo url
# $2 == repo revision
task="run_task.sh"

# git url (https://github.com/...)
repo=$1
# the pull request number
pr_number=$2
repo_dir='git_checkout';
# rest args take everything else and pass its as the cmd
cmd=${@:3:999}
echo $cmd

# mostly so we can re-run tasks manually
rm -f $task

echo "#! /bin/bash -ve" >> $task
echo "cd $repo_dir" >> $task
echo "git fetch --depth 1 origin +refs/pull/$pr_number/merge" >> $task
echo "git checkout -qf FETCH_HEAD" >> $task

# command
echo "$cmd" >> $task

chmod u+x $task
./$task
exit $?
